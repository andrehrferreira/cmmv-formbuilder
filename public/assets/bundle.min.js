(e=>{try{class o{constructor(e){this.metrics={}}start(e){this.metrics[e="Client: "+e]||(this.metrics[e]={start:0,end:0,duration:0}),this.metrics[e].start=performance.now()}end(e){this.metrics[e="Client: "+e]&&(this.metrics[e].end=performance.now(),this.metrics[e].duration=this.metrics[e].end-this.metrics[e].start)}log(){var t,s=e.cmmvTelemetry;0<s?.length&&(t=this.metrics,this.metrics={},s.map((e=>this.metrics["Server: "+e.label]={start:e.startTime,end:e.endTime,duration:e.endTime-e.startTime})),this.metrics={...this.metrics,...t});let i=0;s=Object.keys(this.metrics).map((e=>{var t=this.metrics[e].duration;return i+=t,{Process:e,Duration:t.toFixed(2)+" ms"}})),"dev"===process.env.NODE_ENV&&console.table(s)}}var t={app:null,socket:null,contractIndex:{},contracts:{},context:{},contextApp:null,loaded:!1,binds:{},telemetry:new o,reconnectInterval:1e4,isAuth:!1,theme:"default",styleSettings:{},components:{},vuePlugins:[],methods:{},initialize(e,t,s,i,n){this.telemetry.start("Initialize Frontend"),this.methods=n;try{e.config&&e.config.rpc&&e.config.rpc.enabled&&!window.Vue&&(this.telemetry.start("WebSocket Initialization"),this.connectWebSocket(),this.telemetry.end("WebSocket Initialization"))}catch(e){console.error(e)}"object"==typeof e&&(this.context=Object.assign(this.context,e));var o,c={},r="default"!==this.theme?"."+this.theme:"",a=["get","load","refresh","theme","switch"];if("object"==typeof t)for(var d in this.styleSettings=Object.assign(this.styleSettings,t),this.styleSettings)for(var l in this.styleSettings[d])-1!==l.indexOf(r)&&(o=l.replace(r,""),c[d]||(c[d]={}),a.includes(o)||(c[d][o]=this.styleSettings[d][l]));if(s)for(var p in s){for(var h in this.components[p]={},s[p])s[p][h]&&"string"==typeof s[p][h]&&s[p][h].startsWith("function")?this.components[p][h]=new Function(`return (${s[p][h]})`)():this.components[p][h]=s[p][h];(this.components[p].$parent=this).components[p].$style=this.styles,this.components[p].$style.load()}i&&Array.isArray(i)&&(this.vuePlugins=i),document.addEventListener("DOMContentLoaded",(()=>{this.processExpressions(),this.telemetry.log()})),this.telemetry.end("Initialize Frontend")},connectWebSocket(){var e=window.location.href.replace("https","wss").replace("http","ws");this.socket=new WebSocket(e),this.socket.binaryType="arraybuffer",this.socket.addEventListener("message",this.parseMessage.bind(this)),this.socket.addEventListener("open",(()=>{this.telemetry.end("WebSocket Initialization")})),this.socket.addEventListener("close",(()=>{console.warn("WebSocket disconnected. Attempting to reconnect in 10 seconds..."),setTimeout((()=>{this.connectWebSocket()}),this.reconnectInterval)})),this.socket.addEventListener("error",(e=>{console.error("WebSocket error:",e)}))},addContracts(e){this.telemetry.start("Load Contracts");try{for(var t in this.contractIndex=e.index,e.contracts){var s;e.contracts.hasOwnProperty(t)&&(s=protobuf.Root.fromJSON(e.contracts[t]),this.contracts[t]=s)}this.generateRPCBindings()}catch(e){console.error("Error loading contracts:",e)}this.telemetry.end("Load Contracts")},getContract(e){return this.contracts[e]},parseMessage(e){this.telemetry.start("Parse Message");try{var t=e.data instanceof ArrayBuffer?new Uint8Array(e.data):e.data;let i=this.contracts.ws.lookupType("WsCall").decode(t),n=Object.keys(this.contractIndex).find((e=>this.contractIndex[e].index===i.contract));var s=Object.keys(this.contractIndex[n].types).find((e=>this.contractIndex[n].types[e]===i.message));if(n&&s){let t=this.getContract(n).lookupType(s).decode(i.data);this.binds[n]&&this.binds[n][s]&&this.binds[n][s].forEach((s=>s.apply(this.contextApp,[t,e.socket])))}else console.error("Unknown contract or message type:",i.contract,i.message)}catch(t){console.error(t)}this.telemetry.end("Parse Message")},pack(e,t,s){try{var i,n,o,c,r;return this.contracts[e]&&this.contractIndex[e]?(n=(i=this.contractIndex[e])?.types[t],c=(o=this.contracts[e]?.lookupType(t))&&s?o.encode(s).finish():null,(r=(this.contracts.ws?.lookupType("WsCall"))?.encode({contract:i?.index,message:n,data:c&&c instanceof Uint8Array?c:new Uint8Array}).finish())?new Uint8Array(r):null):(console.error(`Not found in contract list ${e}.`+t),null)}catch(e){console.error(e)}},generateRPCBindings(){Object.keys(cmmv.contracts).forEach((e=>{let t=cmmv.contracts[e];t.nested&&Object.keys(t.nested).forEach((s=>{(s=t.nested[s]).nested&&Object.keys(s.nested).forEach((t=>{-1<t.indexOf("Request")?cmmv[t]=s=>{t.startsWith("Add")?this.rpc.add(e,t,s):t.startsWith("Update")?this.rpc.update(e,t,s):t.startsWith("Delete")&&this.rpc.delete(e,t,{id:s})}:t.indexOf("Response")&&this[t]&&"function"==typeof this[t]&&this.rpc.on(e,t,this[t])}))}))}))},send(e){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(e):console.warn("WebSocket is not open. Unable to send message.")},async processExpressions(){this.telemetry.start("Process Expressions"),this.telemetry.start("CreateApp"),this.styles.load();var t={...this.styles.refresh(),styleSettings:this.styleSettings};if(window.Vue){var s=(Vue||await import("/node_modules/vue/dist/vue.esm-bundler.js")).createApp;let a=Object.assign({},this.context);var i={};let d={};if("object"==typeof e.cmmvSetup.__methods)for(var n in e.cmmvSetup.__methods)i[n]=new Function(`return (${e.cmmvSetup.__methods[n]})`)();try{if(this.context.config.rpc.enabled){let e=(await import("/assets/rpc-mixins.js")).default;d={data:()=>({...a,...e.data?.()}),components:this.components,styles:t,$style:t,mounted(){"function"==typeof this.mounted&&this.mounted(),"function"==typeof e.mounted&&e.mounted.call(this)},created(){"function"==typeof this.created&&this.created(),"function"==typeof e.created&&e.created.call(this)},methods:{...i,...e.methods},...this.context}}else d={data:()=>({...a}),components:this.components,styles:t,$style:t,mounted:this.mounted,created:this.created,methods:{...i},...this.context}}catch{d={data:()=>({...a}),components:this.components,styles:t,$style:t,mounted(){"function"==typeof this.mounted&&this.mounted()},created(){"function"==typeof this.created&&this.created()},methods:{...i},...this.context}}var o=s(d);if(0<this.vuePlugins.length)for(var c in this.vuePlugins){var{plugin:c,config:r}=this.vuePlugins[c];c=await import(c.startsWith("@")?"/node_modules/"+c:c);r?(r=await import(r),o.use(c.default,r.default)):o.use(c)}o.mount("#app")}else this.contextApp=this.reactive({$template:"#app",components:this.components,...this,rpc:this.rpc,$rpc:this.rpc,styles:t,$style:t,...this.context,loaded:!0,mounted:this.mounted,created:this.created}),this.contextApp.styles.load(),s=this.createApp(this.contextApp),this.telemetry.end("CreateApp"),"function"==typeof this.contextApp?.created&&(this.telemetry.start("Created Hook"),this.contextApp?.created(),this.telemetry.end("Created Hook")),this.telemetry.start("Mount App"),this.app=s.mount("#app"),this.telemetry.end("Mount App");"function"==typeof this.contextApp?.mounted&&(this.telemetry.start("Mounted Hook"),this.contextApp?.mounted(),this.telemetry.end("Mounted Hook")),this.telemetry.end("Process Expressions")},rpc:{get(e,t){var s=this?.pack?this:cmmv;e=s.pack.call(s,e,t);s.send(e)},add(e,t,s){var i=this?.pack?this:cmmv;e=i.pack.call(i,e,t,{item:s});i.send(e)},update(e,t,s){var i=this?.pack?this:cmmv;e=i.pack.call(i,e,t,{id:s._id||s.id,item:s});i.send(e)},delete(e,t,s){var i=this?.pack?this:cmmv;e=i.pack.call(i,e,t,{id:s._id||s.id});i.send(e)},on(e,t,s){var i=this?.binds?this:cmmv;i.binds[e]||(i.binds[e]={}),i.binds[e][t]||(i.binds[e][t]=[]),i.binds[e][t].push(s)}},styles:{theme:"default",styleSettings:null,load(){var e=localStorage.getItem("theme")||"default";this.theme=e,this.refresh()},refresh(){var e,t,s="default"!==this.theme?"."+this.theme:"",i=["get","load","refresh","theme","switch"],n=this.styleSettings||cmmv.styleSettings;for(e in n)for(var o in n[e])-1===o.indexOf(s)&&"default"!==this.theme||(t=o.replace(s,""),this[e]||(this[e]={}),i.includes(t))||(this[e][t]=n[e][o]);return this},get(e){var t=e.split(".")[0];e=e.replace(t+".","")+("default"!==this.theme?"."+this.theme:"");return cmmv.styleSettings[t]&&cmmv.styleSettings[t][e]?cmmv.styleSettings[t][e]:""},switch(e){localStorage.setItem("theme",e),this.theme=e,this.refresh()}}};if(e.cmmvSetup){!e.cmmv&&window.Vue&&(e.cmmv=window.Vue),e.cmmv||(e.cmmv={});var s={};if("object"==typeof e.cmmvSetup.__methods)for(var i in e.cmmvSetup.__methods)s[i]=new Function(`return (${e.cmmvSetup.__methods[i]})`)();var n=e.cmmvSetup.__mounted?new Function(`return (${e.cmmvSetup.__mounted})`)():null;e.cmmv=Object.assign({...s,mounted:n},cmmv,e.cmmvSetup,t),e.cmmv.initialize(e.cmmvSetup.__data||{},e.cmmvSetup.__styles||{},e.cmmvSetup.__components||{},e.cmmvSetup.__vuePlugins||{},e.cmmvSetup.methods||{})}else e.cmmv=Object.assign({},t),e.cmmv.initialize({},{},{},{})}catch(t){console.error(t)}})("undefined"!=typeof window?window:global),(e=>{try{e.cmmv.addContracts({index:{locales:{index:0,types:{Locales:0,LocalesList:1,AddLocalesRequest:2,AddLocalesResponse:3,UpdateLocalesRequest:4,UpdateLocalesResponse:5,DeleteLocalesRequest:6,DeleteLocalesResponse:7,GetAllLocalesRequest:8,GetAllLocalesResponse:9,LocalesService:10}},ws:{index:1,types:{WsCall:0}},wserror:{index:2,types:{WsError:0}}},contracts:{locales:{options:{syntax:"proto3"},nested:{locales:{nested:{Locales:{fields:{code:{type:"string",id:1},code3:{type:"string",id:2},codeNum:{type:"int32",id:3},name:{type:"string",id:4},nameOriginal:{type:"string",id:5}}},LocalesList:{fields:{items:{rule:"repeated",type:"Locales",id:1}}},AddLocalesRequest:{fields:{item:{type:"Locales",id:1}}},AddLocalesResponse:{fields:{id:{type:"string",id:1},item:{type:"Locales",id:2}}},UpdateLocalesRequest:{fields:{id:{type:"string",id:1},item:{type:"Locales",id:2}}},UpdateLocalesResponse:{fields:{id:{type:"string",id:1},item:{type:"Locales",id:2}}},DeleteLocalesRequest:{fields:{id:{type:"string",id:1}}},DeleteLocalesResponse:{fields:{success:{type:"bool",id:1},affected:{type:"int32",id:2},id:{type:"string",id:3}}},GetAllLocalesRequest:{fields:{}},GetAllLocalesResponse:{fields:{items:{type:"LocalesList",id:1}}},LocalesService:{methods:{AddLocales:{requestType:"AddLocalesRequest",responseType:"AddLocalesResponse"},UpdateLocales:{requestType:"UpdateLocalesRequest",responseType:"UpdateLocalesResponse"},DeleteLocales:{requestType:"DeleteLocalesRequest",responseType:"DeleteLocalesResponse"},GetAllLocales:{requestType:"GetAllLocalesRequest",responseType:"GetAllLocalesResponse"}}}}}}},ws:{options:{syntax:"proto3"},nested:{ws:{nested:{WsCall:{fields:{contract:{type:"int32",id:1},message:{type:"int32",id:2},data:{type:"bytes",id:3}}}}}}},wserror:{options:{syntax:"proto3"},nested:{wserror:{nested:{WsError:{fields:{message:{type:"string",id:1},code:{type:"int32",id:2},context:{type:"string",id:3}}}}}}}}})}catch(e){console.error("Error loading contracts:",e)}})("undefined"!=typeof window?window:global);